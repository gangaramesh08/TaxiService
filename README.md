README.md
# TaxiService

## Application Services
- API Gateway
    - Authentication of requests
- Login Service
    - Signup workflow
    - Validate/Regenerate OTP
    - Login workflow
    - Add/Update Profile
- Document Service
    - Add/Update documents
    - Background verification workflow
- Driver Tracking Service
    - Device shipment and Tracking
    - Driver Availability
- Common Service
    - Error handling library
    - Models
    - Helper and utility classes


## Technical design
- All services mentioned above are deployed as individual microservices for replication and scalability strategy (these can be split into separate repositories for maintenance, but we have not done so for this assignment)
    - We have the option to scale the services based on the requirement and usage metrics.
    - We can also add autoscaling policies based on CPU, memory, number_of_requests, etc.
- There is an API-GW app which handles all the request authentications. Only once the authentication is successful, the request is forwarded to the corresponding service API
- We are relying on Redis cache for faster lookups. This cache is used to store the OTP information and also to store access_token
- All services have a healthcheck endpoint to ensure that there is no service outage. This API can be called periodically (every 5secs) to validate application status.
    - In case the healthcheck fails, we can use an orchestrator to restart the tasks so that the desired count is same as the actual count
- We also need to enforce rate limits to prevent malicious users and DDOS attacks.

## Functional Workflows

### API Gateway workflows
- All APIs except the initial Signup API call and Login API call, are routed through the API Gateway for authentication.
- In the GW layer, we authenticate each request to ensure that the access_token passed in the request header is valid for the given user.

### Signup workflow
- Driver signs up with their mobile number and password
- On successful Signup, an OTP is generated by the application and send to the mobile number
    - OTP is valid for 120 secs
    - In case the OTP expires, the driver has the provision to request/regenerate a new OTP
    - OTP is stored in a cache(Redis) for improved performance.
- Driver punches in the OTP to validate their account.
- Once the OTP is validated, the driver is prompted to login with their credentials

### Login workflow
- The driver logs in with their credentials.
- On successful authentication, an access_token is created and sent back in the response
- For all successive API calls, this access_token needs to be passed in the request header
- Once the driver logs in, they have to
    - update their profile to provide information like email, age, address, etc
    - the driver also furnishes vehicle information (make, model, type, etc)
    - once the profile update is completed, we move on to the Document Upload workflow

### Document upload workflow
- The driver needs to upload the mandatory documents - PAN, AADHAAR and Driving License
- The documents are uploaded to a secure storage location and the URL is persisted in the DB
- On successful upload and validation of all 3 documents, background verification workflow is triggered

### Background verification workflow
- The documents are send to an external agency for the external background verification procedure
- Once the verification is completed, the external agency informs the background verification service on the status of the application. i.e. whether it was successful or not
    - In case the verification fails, the reason for the failure are also reported back to the driver so that they can take the appropriate corrective measures (if any)
    - Once the verification is successful, we trigger the Tracking device workflow

### Driver Tracking Service
- The tracking device is dispatched to the driver's current address via an external agency
    - The app tracks the transit status and notifies the driver
- Once the device is delivered, the driver can update his availability
- Once the driver is marked available, we would fetch the GPS coordinates of the device to figure out the current location
- The driver would be informed about potential customers who request for a taxi within a 10km radius of his current location